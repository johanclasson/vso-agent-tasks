{
    "id": "4182dbda-71db-4d18-89b3-75255b7802eb",
    "name": "UpdateDatabaseWithDbUp",
    "friendlyName": "DbUp Migration",
    "description": "Runs SQL Server change scripts, and only those which have not been run already.",
    "helpMarkDown": "[More Information](https://github.com/johanclasson/vso-agent-tasks)",
    "category": "Deploy",
    "visibility": [
        "Build",
        "Release"
    ],
    "author": "Johan Classon",
    "version": {
        "Major": 1,
        "Minor": 1,
        "Patch": 4
    },
    "demands": [
        "DotNetFramework"
    ],
    "groups": [
        {
            "name": "scriptSelection",
            "displayName": "Script Selection",
            "isExpanded": true
        },
        {
            "name": "scriptExecution",
            "displayName": "Script Execution",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "ConnectionString",
            "type": "string",
            "label": "Connection String",
            "defaultValue": "Server=$(DbUp.Server);Database=$(DbUp.Database);User ID=$(DbUp.UserId);Password=$(DbUp.Password);Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;",
            "helpMarkDown": "The connection string to the database where the scripts should run on.",
            "required": true
        },

        {
            "name": "ScriptPath",
            "type": "filePath",
            "label": "Script Folder Path",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "The folder path where all scripts which should be run are located.",
            "groupName": "scriptSelection"
        },
        {
            "name": "IncludeSubfolders",
            "type": "boolean",
            "label": "Include Subfolders",
            "defaultValue": false,
            "helpMarkDown": "If not set, only the scripts directly in the Script Folder Path will be executed. If set, scripts in subfolders will also be executed. Scripts in subfolders are journaled prefixed with their relative folder path.",
            "groupName": "scriptSelection"
        },
        {
            "name": "Order",
            "type": "pickList",
            "options": {
                "Filename": "Filename",
                "FilePath": "File Path",
                "FolderStructure": "Folder Structure"
            },
            "label": "Script Execution Order",
            "defaultValue": "FilePath",
            "helpMarkDown": "The order in which scripts are executed. If set to Filename, scripts can be organized in different folders while still controlling execution order by their filenames. If set to File Path, scripts are strictly sorted on their complete path. If set to Folder Structure, scripts are executed in the order of the file system provider, which means one folder at the time starting with the files in each folder and then working its way through each subfolder. All scripts are executed in ascending order.",
            "visibleRule":  "IncludeSubfolders = true",
            "groupName": "scriptSelection"
        },
        {
            "name": "ScriptFileFilter",
            "type": "string",
            "label": "Script File Filter",
            "defaultValue": ".*",
            "helpMarkDown": "A regular expression that decides if only some of the scripts in the script folder path should be run. For example, if journaled scripts are named 201601011213-script_description.sql and the not journaled scripts are named everytime-script_description.sql, set the filter to ^everytime to target just the not journaled scripts.",
            "groupName": "scriptSelection"
        },
        {
            "name": "ScriptEncoding",
            "type": "pickList",
            "options": {
                "001-Default": "Default",
                "002-65000": "Unicode (UTF-7) [utf-7]",
                "003-65001": "Unicode (UTF-8) [utf-8]",
                "004-1200": "Unicode (UTF-16) [utf-16]",
                "005-1201": "Unicode (UTF-16 Big-Endian) [utf-16BE]",
                "006-12000": "Unicode (UTF-32) [utf-32]",
                "007-12001": "Unicode (UTF-32 Big-Endian) [utf-32BE]",
                "008-864": "Arabic (864) [IBM864]",
                "009-708": "Arabic (ASMO 708) [ASMO-708]",
                "010-720": "Arabic (DOS) [DOS-720]",
                "011-28596": "Arabic (ISO) [iso-8859-6]",
                "012-10004": "Arabic (Mac) [x-mac-arabic]",
                "013-1256": "Arabic (Windows) [windows-1256]",
                "014-775": "Baltic (DOS) [ibm775]",
                "015-28594": "Baltic (ISO) [iso-8859-4]",
                "016-1257": "Baltic (Windows) [windows-1257]",
                "017-852": "Central European (DOS) [ibm852]",
                "018-28592": "Central European (ISO) [iso-8859-2]",
                "019-10029": "Central European (Mac) [x-mac-ce]",
                "020-1250": "Central European (Windows) [windows-1250]",
                "021-51936": "Chinese Simplified (EUC) [EUC-CN]",
                "022-54936": "Chinese Simplified (GB18030) [GB18030]",
                "023-936": "Chinese Simplified (GB2312) [gb2312]",
                "024-20936": "Chinese Simplified (GB2312-80) [x-cp20936]",
                "025-52936": "Chinese Simplified (HZ) [hz-gb-2312]",
                "026-50227": "Chinese Simplified (ISO-2022) [x-cp50227]",
                "027-10008": "Chinese Simplified (Mac) [x-mac-chinesesimp]",
                "028-950": "Chinese Traditional (Big5) [big5]",
                "029-20000": "Chinese Traditional (CNS) [x-Chinese-CNS]",
                "030-20002": "Chinese Traditional (Eten) [x-Chinese-Eten]",
                "031-10002": "Chinese Traditional (Mac) [x-mac-chinesetrad]",
                "032-10082": "Croatian (Mac) [x-mac-croatian]",
                "033-866": "Cyrillic (DOS) [cp866]",
                "034-28595": "Cyrillic (ISO) [iso-8859-5]",
                "035-20866": "Cyrillic (KOI8-R) [koi8-r]",
                "036-21866": "Cyrillic (KOI8-U) [koi8-u]",
                "037-10007": "Cyrillic (Mac) [x-mac-cyrillic]",
                "038-1251": "Cyrillic (Windows) [windows-1251]",
                "039-28603": "Estonian (ISO) [iso-8859-13]",
                "040-29001": "Europa [x-Europa]",
                "041-863": "French Canadian (DOS) [IBM863]",
                "042-20106": "German (IA5) [x-IA5-German]",
                "043-737": "Greek (DOS) [ibm737]",
                "044-28597": "Greek (ISO) [iso-8859-7]",
                "045-10006": "Greek (Mac) [x-mac-greek]",
                "046-1253": "Greek (Windows) [windows-1253]",
                "047-869": "Greek, Modern (DOS) [ibm869]",
                "048-862": "Hebrew (DOS) [DOS-862]",
                "049-38598": "Hebrew (ISO-Logical) [iso-8859-8-i]",
                "050-28598": "Hebrew (ISO-Visual) [iso-8859-8]",
                "051-10005": "Hebrew (Mac) [x-mac-hebrew]",
                "052-1255": "Hebrew (Windows) [windows-1255]",
                "053-20420": "IBM EBCDIC (Arabic) [IBM420]",
                "054-20880": "IBM EBCDIC (Cyrillic Russian) [IBM880]",
                "055-21025": "IBM EBCDIC (Cyrillic Serbian-Bulgarian) [cp1025]",
                "056-20277": "IBM EBCDIC (Denmark-Norway) [IBM277]",
                "057-1142": "IBM EBCDIC (Denmark-Norway-Euro) [IBM01142]",
                "058-20278": "IBM EBCDIC (Finland-Sweden) [IBM278]",
                "059-1143": "IBM EBCDIC (Finland-Sweden-Euro) [IBM01143]",
                "060-20297": "IBM EBCDIC (France) [IBM297]",
                "061-1147": "IBM EBCDIC (France-Euro) [IBM01147]",
                "062-20273": "IBM EBCDIC (Germany) [IBM273]",
                "063-1141": "IBM EBCDIC (Germany-Euro) [IBM01141]",
                "064-875": "IBM EBCDIC (Greek Modern) [cp875]",
                "065-20423": "IBM EBCDIC (Greek) [IBM423]",
                "066-20424": "IBM EBCDIC (Hebrew) [IBM424]",
                "067-20871": "IBM EBCDIC (Icelandic) [IBM871]",
                "068-1149": "IBM EBCDIC (Icelandic-Euro) [IBM01149]",
                "069-500": "IBM EBCDIC (International) [IBM500]",
                "070-1148": "IBM EBCDIC (International-Euro) [IBM01148]",
                "071-20280": "IBM EBCDIC (Italy) [IBM280]",
                "072-1144": "IBM EBCDIC (Italy-Euro) [IBM01144]",
                "073-20290": "IBM EBCDIC (Japanese katakana) [IBM290]",
                "074-20833": "IBM EBCDIC (Korean Extended) [x-EBCDIC-KoreanExtended]",
                "075-870": "IBM EBCDIC (Multilingual Latin-2) [IBM870]",
                "076-20284": "IBM EBCDIC (Spain) [IBM284]",
                "077-1145": "IBM EBCDIC (Spain-Euro) [IBM01145]",
                "078-20838": "IBM EBCDIC (Thai) [IBM-Thai]",
                "079-1026": "IBM EBCDIC (Turkish Latin-5) [IBM1026]",
                "080-20905": "IBM EBCDIC (Turkish) [IBM905]",
                "081-20285": "IBM EBCDIC (UK) [IBM285]",
                "082-1146": "IBM EBCDIC (UK-Euro) [IBM01146]",
                "083-37": "IBM EBCDIC (US-Canada) [IBM037]",
                "084-1140": "IBM EBCDIC (US-Canada-Euro) [IBM01140]",
                "085-20924": "IBM Latin-1 [IBM00924]",
                "086-1047": "IBM Latin-1 [IBM01047]",
                "087-20003": "IBM5550 Taiwan [x-cp20003]",
                "088-861": "Icelandic (DOS) [ibm861]",
                "089-10079": "Icelandic (Mac) [x-mac-icelandic]",
                "090-57006": "ISCII Assamese [x-iscii-as]",
                "091-57003": "ISCII Bengali [x-iscii-be]",
                "092-57002": "ISCII Devanagari [x-iscii-de]",
                "093-57010": "ISCII Gujarati [x-iscii-gu]",
                "094-57008": "ISCII Kannada [x-iscii-ka]",
                "095-57009": "ISCII Malayalam [x-iscii-ma]",
                "096-57007": "ISCII Oriya [x-iscii-or]",
                "097-57011": "ISCII Punjabi [x-iscii-pa]",
                "098-57004": "ISCII Tamil [x-iscii-ta]",
                "099-57005": "ISCII Telugu [x-iscii-te]",
                "100-20269": "ISO-6937 [x-cp20269]",
                "101-51932": "Japanese (EUC) [euc-jp]",
                "102-20932": "Japanese (JIS 0208-1990 and 0212-1990) [EUC-JP]",
                "103-50220": "Japanese (JIS) [iso-2022-jp]",
                "104-50222": "Japanese (JIS-Allow 1 byte Kana - SO/SI) [iso-2022-jp]",
                "105-50221": "Japanese (JIS-Allow 1 byte Kana) [csISO2022JP]",
                "106-10001": "Japanese (Mac) [x-mac-japanese]",
                "107-932": "Japanese (Shift-JIS) [shift_jis]",
                "108-949": "Korean [ks_c_5601-1987]",
                "109-51949": "Korean (EUC) [euc-kr]",
                "110-50225": "Korean (ISO) [iso-2022-kr]",
                "111-1361": "Korean (Johab) [Johab]",
                "112-10003": "Korean (Mac) [x-mac-korean]",
                "113-20949": "Korean Wansung [x-cp20949]",
                "114-28593": "Latin 3 (ISO) [iso-8859-3]",
                "115-28605": "Latin 9 (ISO) [iso-8859-15]",
                "116-865": "Nordic (DOS) [IBM865]",
                "117-20108": "Norwegian (IA5) [x-IA5-Norwegian]",
                "118-855": "OEM Cyrillic [IBM855]",
                "119-858": "OEM Multilingual Latin I [IBM00858]",
                "120-437": "OEM United States [IBM437]",
                "121-860": "Portuguese (DOS) [IBM860]",
                "122-10010": "Romanian (Mac) [x-mac-romanian]",
                "123-20107": "Swedish (IA5) [x-IA5-Swedish]",
                "124-20261": "T.61 [x-cp20261]",
                "125-20001": "TCA Taiwan [x-cp20001]",
                "126-20004": "TeleText Taiwan [x-cp20004]",
                "127-10021": "Thai (Mac) [x-mac-thai]",
                "128-874": "Thai (Windows) [windows-874]",
                "129-857": "Turkish (DOS) [ibm857]",
                "130-28599": "Turkish (ISO) [iso-8859-9]",
                "131-10081": "Turkish (Mac) [x-mac-turkish]",
                "132-1254": "Turkish (Windows) [windows-1254]",
                "133-10017": "Ukrainian (Mac) [x-mac-ukrainian]",
                "134-20127": "US-ASCII [us-ascii]",
                "135-1258": "Vietnamese (Windows) [windows-1258]",
                "136-20005": "Wang Taiwan [x-cp20005]",
                "137-850": "Western European (DOS) [ibm850]",
                "138-20105": "Western European (IA5) [x-IA5]",
                "139-28591": "Western European (ISO) [iso-8859-1]",
                "140-10000": "Western European (Mac) [macintosh]",
                "141-1252": "Western European (Windows) [Windows-1252]"
        },
            "label": "Script Encoding",
            "defaultValue": "001-Default",
            "helpMarkDown": "The encoding used to read script files from the file system. Default means using the operating system's current ANSI code page.",
            "groupName": "scriptSelection"
        },

        {
            "name": "TransactionStrategy",
            "type": "pickList",
            "options": {
                "NoTransactions": "No Transactions",
                "TransactionPerScript": "Transaction Per Script",
                "SingleTransaction": "Single Transaction"
            },
            "label": "Transaction Strategy",
            "defaultValue": "TransactionPerScript",
            "helpMarkDown": "Select No Transactions if you want to have manual control over the transactions through the content of the SQL scripts.",
            "groupName": "scriptExecution"
        },
        {
            "name": "JournalToSqlTable",
            "type": "boolean",
            "label": "Journal To SQL Table",
            "defaultValue": true,
            "helpMarkDown": "If the scripts should be journaled in a SQL table. Not journaled scripts will be run each time.",
            "groupName": "scriptExecution"
        },
        {
            "name": "JournalName",
            "type": "string",
            "label": "Journal Table Name",
            "defaultValue": "_SchemaVersions",
            "helpMarkDown": "The name of the journal table, if enabled.",
            "required": true,
            "visibleRule":  "JournalToSqlTable = true",
            "groupName": "scriptExecution"
        },
        {
            "name": "VariableSubstitution",
            "type": "boolean",
            "label": "Perform Variable Substitution",
            "defaultValue": false,
            "helpMarkDown": "If set, SQL variable substitution will be made with matching environment variables. For example, if the Variable Substitution Prefix is DBUP, the environment variable DBUP_MYNAME will match $MYNAME$ in the SQL scripts. If the prefix is empty, the environment variable MYNAME will match $MYNAME$ directly. Note that the casing of the variables must match, and that build and release variables are converted to uppercase as environment variables. For example, DbUp.MyName will be available as DBUP_MYNAME, and will correspond to the SQL variable $MYNAME$.",
            "groupName": "scriptExecution"
        },
        {
            "name": "VariableSubstitutionPrefix",
            "type": "string",
            "label": "Variable Substitution Prefix",
            "defaultValue": "DbUp",
            "helpMarkDown": "Filters what environment variables that is used in variable substitution. The prefix is removed from the matched variable substitution name. If the prefix is empty, then all of the available environment variables will be used in the SQL variable substitution matching. The filtering of environment variables are case insensitive.",
            "visibleRule":  "VariableSubstitution = true",
            "groupName": "scriptExecution"
        },
        {
            "name": "LogScriptOutput",
            "type": "boolean",
            "label": "Include Script Output in Log",
            "defaultValue": false,
            "helpMarkDown": "If information and warning logs raised from the SQL scripts should be visible in the log output or not.",
            "groupName": "scriptExecution"
        }
    ],
    "instanceNameFormat": "DbUp Migration",
    "execution": {
        "PowerShell": {
            "target": "$(currentDirectory)\\Update-Database.ps1",
            "argumentFormat": "",
            "workingDirectory": "$(currentDirectory)"
        }
    }
}
